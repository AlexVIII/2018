## SQL JDBC

[1. Что такое первичный ключ?](#1-Что-такое-первичный-ключ)

[2. Что такое внешний ключ?](#2-Что-такое-внешний-ключ)

[3. Что такое нормализация БД?](#3-Что-такое-нормализация-БД)

[4. Что такое денормализация БД? Для чего она нужна?](#4-Что-такое-денормализация-БД-Для-чего-она-нужна)

[5. Что такое кластерный и некластерный индекс?](#5-Что-такое-кластерный-и-некластерный-индекс)

[6. Какие типы соединений (join) таблиц существуют? В чем их разница?](#6-Какие-типы-соединений-(join)-таблиц-существуют-В-чем-их-разница)

[7. Что такое SQL курсор?](#7-Что-такое-SQL-курсор)

[8. Опишите шаги по созданию и использованию курсора?](#8-Опишите-шаги-по-созданию-и-использованию-курсора)

[9. Что такое транзакция?](#9-Что-такое-транзакция)

[10. Что такое триггер? (Какие типы триггеров вы знаете?)](#10-Что-такое-триггер-(Какие-типы-триггеров-вы-знаете))

[11. В чем разница между WHERE и HAVING?](#11-В-чем-разница-между-WHERE-и-HAVING)

[12. Что такое подзапрос (sub-query)?](#12-Что-такое-подзапрос-(sub-query))

[13. Что такое union?](#13-Что-такое-union)

[14. Что такое group by?](#14-Что-такое-group-by)

[15. Что такое хранимые процедуры?](#15-Что-такое-хранимые-процедуры)

[16. Что такое view(Представление)?](#16-Что-такое-view(Представление))

[17. Опишите процесс создания запроса через JDBC?](#17-Опишите-процесс-создания-запроса-через-JDBC)

[18. Для чего используется конструкция try-with-resources?](#18-Для-чего-используется-конструкция-try-with-resources)



## 1 Что такое первичный ключ?

**Первичный ключ (primary key)** является полем в таблице, которое однозначно идентифицирует каждую строку/запись 
в таблице базы данных. Первичные ключи должны содержать уникальные значения. Первичный ключ столбец не может иметь значения NULL.

Таблица может иметь только один первичный ключ, который может состоять из одного или нескольких полей. 
Когда несколько полей используются в качестве первичного ключа, их называют составным ключом.
Поэтому в качестве первичного ключа, как правило, выбирают тот, который имеет наименьший размер (физического хранения) 
и/или включает наименьшее количество атрибутов. Другой критерий выбора первичного ключа — сохранение его уникальности 
со временем. Поэтому в качестве первичного ключа стараются выбирать такой потенциальный ключ, который 
с наибольшей вероятностью никогда не утратит уникальность.

[к оглавлению](#SQL)

## 2 Что такое внешний ключ?

**Внешний ключ (foreign key)** —  это столбец или комбинация столбцов, значения которых соответствуют 
Первичному ключу в другой таблице. Связь между двумя таблицами задается через соответствие Первичного ключа в одной 
из таблиц внешнему ключу во второй.

[к оглавлению](#SQL)

## 3 Что такое нормализация БД?

**Нормализация** - это процесс преобразования отношений базы данных к виду, отвечающему нормальным формам (пошаговый, 
обратимый процесс замены исходной схемы другой схемой, в которой наборы данных имеют более простую и логичную структуру).
Нормализация предназначена для приведения структуры базы данных к виду, обеспечивающему минимальную логическую 
избыточность, и не имеет целью уменьшение или увеличение производительности работы или же уменьшение или увеличение 
физического объёма базы данных. Конечной целью нормализации является уменьшение потенциальной противоречивости хранимой 
в базе данных информации.

[к оглавлению](#SQL)

## 4 Что такое денормализация БД Для чего она нужна?

Добавление "избыточных" данных с целью:
1. Для сохранения истории.
2. Повышение производительности запросов за счет экономии на объединениях.
3. Предварительные вычисления часто запрашиваемых значений.

[к оглавлению](#SQL)

## 5 Что такое кластерный и некластерный индекс?

По способу хранения данных отличают кластерные и обычные индексы.
+ **Обычно индекс** — это отсортированный набор данных колонки, по которой он построен. Индекс будет хранить ссылки на данные каждой строки для каждого значения ID.
+ **Кластерный индекс** (или кластерный ключ) сохраняет не только значения колонки в отсортированном виде, а и данные всей строки. 

Это позволяет минимизировать количество операций чтения с диска при работе с таким индексом. В таблице может быть только один кластерный индекс.

https://habr.com/ru/post/141767/

[к оглавлению](#SQL)

## 6 Какие типы соединений (join) таблиц существуют В чем их разница?

+ **INNER JOIN** Выбираются только совпадающие данные из объединяемых таблиц.
+ **OUTER JOIN** Такое объединение вернет совпадающие данные из объединяемых таблиц ПЛЮС дополнит выборку оставшимися данными 
из внешней таблицы, которые по условию не подходят, заполнив недостающие данные значением NULL.
+ Существует два типа внешнего объединения OUTER JOIN - **LEFT OUTER JOIN** и **RIGHT OUTER JOIN**. 
+ **FULL JOIN** возвращает `объединение` объединений LEFT и RIGHT таблиц, комбинируя результат двух запросов.
+ **CROSS JOIN** возвращает перекрестное (декартово) объединение двух таблиц. Результатом будет выборка всех записей первой 
таблицы объединенная с каждой строкой второй таблицы. Важным моментом является то, что для кросса не нужно указывать 
условие объединения.
+ **SELF JOIN** соединение таблицы с этой же таблице.

При использовании объединения новички часто забывают что результирующая выборка может содержать дублирующиеся данные!

Статья про join: http://www.skillz.ru/dev/php/article-Obyasnenie_SQL_obedinenii_JOIN_INNER_OUTER.html


[к оглавлению](#SQL)

## 7 Что такое SQL курсор?

Команды манипулирования данными SELECT, UPDATE, DELETE работают сразу с группами строк. 
Эти группы, вплоть до отдельных строк, можно выбрать с помощью опции WHERE. 
А если надо перебрать строки некоторой таблицы последовательно, одну за другой? На этот случай в языке SQL существуют курсоры. 

**Курсор (current set of record)** – временный набор строк, которые можно перебирать последовательно, с первой до последней.
Это эффективный способ получать большие наборы строк из функций по частям. 
Если выборка осуществляется через курсорные переменные, которые всегда имеют специальный тип данных refcursor.

[к оглавлению](#SQL)

## 8 Опишите шаги по созданию и использованию курсора?

При работе с курсорами используются следующие команды.
+ **Объявление курсора**: 
DECLARE имя_курсора CURSOR FOR SELECT текст_запроса
Любой курсор создается на основе некоторого оператора SELECT.
+ **Открытие курсора**:
OPEN имя_курсора
Для того чтобы с помощью курсора можно было читать строки, его надо обязательно открыть.
+ **Чтение следующей строки из курсора**:
FETCH имя_курсора INTO список_переменных
Переменные в списке должны быть в том же количестве и того е типа, что и столбцы курсора. 
Глобальная переменная @@FETCH_STATUS принимает ненулевое значение, если строк в курсоре больше нет. Если же набор строк еще не исчерпан, то @@FETCH_STATUS равна нулю, и оператор FETCH перепишет значения полей из текущей строки в переменные. 
+ **Закрытие курсора**:
CLOSE имя_курсора
+ Для **удаления курсора из памяти** используется команда 
DEALLOCATE имя_курсора
Для иллюстрации использования курсора создадим процедуру, которая будет выбирать данные из одной таблицы, 
перебирать их в курсоре анализируя, есть ли такие данные во второй таблице и вставлять в третью таблицу, 
если данные записи удовлетворяют определённым критериям.

```sql
CREATE PROCEDURE [dbo].[MyProcedure] AS
DECLARE @ID INT
DECLARE         @QUA INT
DECLARE @VAL VARCHAR (500)
DECLARE @NAM VARCHAR (500)
/*Объявляем курсор*/
DECLARE @CURSOR CURSOR
/*Заполняем курсор*/
SET @CURSOR  = CURSOR SCROLL
FOR
SELECT  INDEX, QUANTITY, VALUE,  NAME  
  FROM  My_First_Table WHERE  QUANTITY > 1
/*Открываем курсор*/
OPEN @CURSOR
/*Выбираем первую строку*/
FETCH NEXT FROM @CURSOR INTO @ID, @QUA, @VAL, @NAM
/*Выполняем в цикле перебор строк*/
WHILE @@FETCH_STATUS = 0
BEGIN
        IF NOT EXISTS(SELECT VAL FROM My_Second_Table WHERE ID=@ID)
        BEGIN
/*Вставляем параметры в третью таблицу если условие соблюдается*/
                INSERT INTO My_Third_Table (VALUE, NAME) VALUE(@VAL, @NAM)
        END
/*Выбираем следующую строку*/
FETCH NEXT FROM @CURSOR INTO @ID, @QUA, @VAL, @NAM
END
CLOSE @CURSOR
```

[к оглавлению](#SQL)

## 9 Что такое транзакция?

Группа последовательных операций с базой данных, которая представляет собой логическую единицу работы с данными. 
Транзакция может быть выполнена либо целиком и успешно, соблюдая целостность данных и независимо от параллельно 
идущих других транзакций, либо не выполнена вообще, и тогда она не должна произвести никакого эффекта.

[к оглавлению](#SQL)

## 10 Что такое триггер (Какие типы триггеров вы знаете)?

Триггеры — это части кода, запускаемые автоматически и основанные на каком-либо действии или событии в таблице 
базы данных.
 
Триггеры могут применять в таблице во время выполнения операторов INSERT, UPDATE или DELETE, а затем работать 
или перед, или после этих действий.
 
Некоторые СУБД также позволяют работать триггерам на уровне оператора или на уровне каждой строки данных во 
время ее изменения.

Пример использования триггеров: https://habr.com/ru/post/146717/


[к оглавлению](#SQL)

## 11 В чем разница между WHERE и HAVING?

+ WHERE - сначала отбирает сторки а потом применяет к ним GROUP BY и агрегатные функции типа COUNT(*)
+ HAVING - наоборот сначала все функции и группировки а потом выборка

[к оглавлению](#SQL)

## 12 Что такое подзапрос (sub query)?

Запрос который выполнится перед основным и результаты которого будут теми данными из которых будет дальнейшая обработка 
основным запросом.

[к оглавлению](#SQL)

## 13 Что такое union?

В языке SQL операция UNION применяется для объединения двух наборов строк, возвращаемых SQL-запросами. 
Оба запроса должны возвращать одинаковое число столбцов, и столбцы с одинаковым порядковым номером должны иметь 
совместимые типы данных. Результат получает структуру (названия и типы столбцов) первого (левого) запроса, то есть 
операция не является симметричной.

При объединении нескольких запросов подряд результат последовательно вычисляется слева направо.

[к оглавлению](#SQL)

## 14 Что такое group by?

Предложение GROUP BY используется для определения групп выходных строк, к которым могут применяться агрегатные функции (COUNT, MIN, MAX, AVG и SUM).
все столбцы списка SELECT, не вошедшие в агрегатные функции, должны быть указаны в предложении GROUP BY. 

В результате чего все выходные строки запроса разбиваются на группы, характеризуемые одинаковыми комбинациями значений 
в этих столбцах. После чего к каждой группе будут применены агрегатные функции. Следует иметь в виду, что для GROUP BY 
все значения NULL трактуются как равные, то есть при группировке по полю, содержащему NULL-значения, 
все такие строки попадут в одну группу.

[к оглавлению](#SQL)

## 15 Что такое хранимые процедуры?

Объект базы данных, представляющий собой набор SQL-инструкций, который компилируется один раз и хранится на сервере. 
Хранимые процедуры очень похожи на обыкновенные процедуры языков высокого уровня, у них могут быть входные и выходные 
параметры и локальные переменные, в них могут производиться числовые вычисления и операции над символьными данными, 
результаты которых могут присваиваться переменным и параметрам. В хранимых процедурах могут выполняться стандартные 
операции с базами данных (как DDL, так и DML). Кроме того, в хранимых процедурах возможны циклы и ветвления, 
то есть в них могут использоваться инструкции управления процессом исполнения.
Хранимые процедуры похожи на определяемые пользователем функции (UDF). Основное различие заключается в том, 
что пользовательские функции можно использовать как и любое другое выражение в SQL запросе, в то время как 
хранимые процедуры должны быть вызваны с помощью функции CALL:

```sql
CALL процедура(…)
```
или

```sql
EXECUTE процедура(…)
```

Хранимые процедуры могут возвращать множества результатов, то есть результаты запроса SELECT. 
Такие множества результатов могут обрабатываться, используя курсоры, другими сохранёнными процедурами, 
возвращая указатель результирующего множества, либо же приложениями. Хранимые процедуры могут также содержать 
объявленные переменные для обработки данных и курсоров, которые позволяют организовать цикл по нескольким 
строкам в таблице. Стандарт SQL предоставляет для работы выражения IF, LOOP, REPEAT, CASE и многие другие. 
Хранимые процедуры могут принимать переменные, возвращать результаты или изменять переменные и возвращать их, 
в зависимости от того, где переменная объявлена.

https://habr.com/ru/post/79340/

http://javatutor.net/articles/stored-procedures-for-java-programmers

[к оглавлению](#SQL)

## 16 Что такое view(Представление)?

Представление (VIEW) — объект базы данных, являющийся результатом выполнения запроса к базе данных, 
определенного с помощью оператора SELECT, в момент обращения к представлению.
Представления иногда называют «виртуальными таблицами».
Такое название связано с тем, что представление доступно для пользователя как таблица, 
но само оно не содержит данных, а извлекает их из таблиц в момент обращения к нему.

https://habr.com/ru/post/47031/

[к оглавлению](#SQL)

## 17 Опишите процесс создания запроса через JDBC?

+ Загрузка драйвера базы данных.Для загрузки/использования нашего драйвера можно пойти двумя путями. 
Первый – это вписать имя драйвера в код программы. В этом случае мы не сможем изменить СУБД без перекомпиляции. 
Второй – это подключать драйвер из командной строки Java (JVM). 
Следующей строчкой мы загружаем драйвер, и он автоматически зарегистрируется себя для использования вместе с JDBC.

```
Class.forName(“postgresql.Driver”);
```

Во втором же случае мы используем ключ –D для подключения драйвера.

```
java –Djdbc.drivers=postgresql.Driver myClass
```
+ Для соединения с базой данных используют класс Connection:

```
Connection dbh = DriverManager.getConnection(url, user, passwd);
```

+ Установив соединение, мы можем выполнять sql-запросы к нашей базе данных. 
Для примера, рассмотрим небольшой кусок кода на Java:

```
Statement st = dbh.createStatement();
ResultSet rs = st.executeQuery(
"select * from flowers_tbl where (flowers_id in (1,2,3,4,5,6,7,8,9))"
);
while (rs.next())
{
  System.out.println(rs.getString(1));
}
rs.close();
st.close();
```

Для того, чтобы посылать запросы к базе данных, необходимо создать экземпляр класса Statement st. 
Метод executeQuery этого класса отправляет переданный ему запрос к базе данных и в качестве ответа возвращает результат 
в виде класса ResultSet.

В конце надо закрыть все.

[к оглавлению](#SQL)

## 18 Для чего используется конструкция try with resources?

Данная конструкция(try-with-resources) появилась в java 7, 
она позволяет использовать блок try-catch не заботясь о закрытии ресурсов, используемых в данном сегменте кода.
Ресурсы объявляются в скобках сразу после try, а компилятор уже сам неявно создаёт секцию finally в которой
и происходит закрытие без участия разработчика. Конструкция является так называемым «синтаксическим сахаром»
и создана для облегчения жизни программиста. 
Под ресурсами подразумеваются сущности, реализующие интерфейс java.lang.Autocloseable.
Общий вид конструкции выглядит следующим образом

```
try(тут объявляются ресурсы){
    ...
    ...
}catch(Exception ex){
    ...
}finally{
    ...
}
```

Стоит заметить, что блоки catch и явный finally выполняются уже после того, как закрываются ресурсы в неявном finnaly.

[к оглавлению](#SQL)